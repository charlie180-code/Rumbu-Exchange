{% extends "api/base.html" %}

{% block title %}{{ _('Ajouter un nouveau Portefeuille') }}{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/wallet.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
{% endblock %}

{% block content %}
<form method="POST" action="{{ url_for('api.add_wallet') }}">
    <h1 class="h3 mb-3 fw-normal">
        {{ _('Ajouter un portefeuille') }}
    </h1>

    <div class="mb-4">
        <label for="walletProvider" class="form-label">{{ _('Fournisseur') }}</label>
        <select name="provider" id="walletProvider" class="form-select" required>
            <option value="">{{ _('Sélectionnez un fournisseur') }}</option>
            <option value="Nita" data-icon="{{ url_for('static', filename='brands/nita.jpeg') }}">
                {{ _('Nita') }}
            </option>
            <option value="Visa" data-icon="{{ url_for('static', filename='brands/visa.svg') }}">
                {{ _('Visa') }}
            </option>
            <option value="Mastercard" data-icon="{{ url_for('static', filename='brands/mastercard.svg') }}">
                {{ _('Mastercard') }}
            </option>
            <option value="PayPal" data-icon="{{ url_for('static', filename='brands/paypal.svg') }}">
                {{ _('PayPal') }}
            </option>
        </select>
    </div>

    <div class="mb-3" id="phoneNumberField" style="display: none;">
        <label for="phoneNumber" class="form-label">{{ _('Numéro de téléphone') }}</label>
        <input type="text" name="phone_number" class="form-control" id="phoneNumber" placeholder="{{ _('0612345678') }}" required>
    </div>

    <div class="mb-3" id="cardNumberField" style="display: none;">
        <label for="cardNumber" class="form-label">{{ _('Numéro de carte') }}</label>
        <input type="text" name="card_number" class="form-control" id="cardNumber" placeholder="{{ _('1234 5678 9012 3456') }}" required>
    </div>
    
    <div class="mb-3" id="cvvField" style="display: none;">
        <label for="cvv" class="form-label">{{ _('CVV') }}</label>
        <input type="text" name="cvv" class="form-control" id="cvv" placeholder="{{ _('123') }}" required>
    </div>

    <div class="mb-3" id="expirationField" style="display: none;">
        <label for="expirationDate" class="form-label">{{ _('Date d\'expiration') }}</label>
        <input type="text" name="expiration_date" class="form-control" id="expirationDate" placeholder="{{ _('12/25') }}" required>
    </div>

    <div class="mb-3" id="emailField" style="display: none;">
        <label for="email" class="form-label">{{ _('Adresse e-mail') }}</label>
        <input type="email" name="email" class="form-control" id="email" placeholder="{{ _('email@example.com') }}" required>
    </div>
    
    <button class="w-100 btn btn-md submit-btn" type="submit">
        {{ _('Continuer') }}
    </button>
</form>
{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
    $(document).ready(function() {
        $('#walletProvider').select2({
            templateResult: formatOption,
            templateSelection: formatOption
        });

        function formatOption(option) {
            if (!option.id) { return option.text; }
            var $option = $(
                '<div class="provider-option"><img src="' + $(option.element).data('icon') + '" /> ' + option.text + '</div>'
            );
            return $option;
        }

        $('#walletProvider').on('change', function() {
            var provider = this.value;
            document.getElementById("phoneNumberField").style.display = (provider === "Nita") ? "block" : "none";
            document.getElementById("cardNumberField").style.display = (provider === "Visa" || provider === "Mastercard") ? "block" : "none";
            document.getElementById("cvvField").style.display = (provider === "Visa" || provider === "Mastercard") ? "block" : "none";
            document.getElementById("expirationField").style.display = (provider === "Visa" || provider === "Mastercard") ? "block" : "none";
            document.getElementById("emailField").style.display = (provider === "PayPal") ? "block" : "none";
        });
    });
</script>
{% endblock %}